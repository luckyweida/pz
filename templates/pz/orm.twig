{% extends 'pz/layout.twig' %}
{% block extraBodyClass %}page-content{% endblock %}

{% block asset %}
	<link rel="stylesheet" href="{{ asset('build/cms-orm.css') }}" as="style" rel="preload">
	<script src="{{ asset('build/cms-orm.js') }}" async defer></script>
{% endblock %}

{% set model = db.byId('_Model', fragments.2) %}
{% if orm is not defined %}
	{% set orm = db.byId(model.className, fragments|last) ?: db.create(model.className) %}
{% endif %}
{% set form = ormHandler.handle(model, orm) %}
{% form_theme form 'pz/form.twig' %}

{% set returnUrl = app.request.get('returnUrl') ?: '/pz/admin/' ~ model.id %}

{% block extraHead %}
	{#<link rel="stylesheet" type="text/css" href="{{ getenv('CDN') }}/redactor/redactor/redactor.css" />#}
	{#<link href="{{ getenv('CDN') }}/inspinia/css/plugins/jsTree/style.min.css" rel="stylesheet">#}
{% endblock %}

{% block extraHeaderLeft %}
	<h2>Manage <label class="label label-warning-light">{{ model.title }}</label></h2>
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col-lg-12 max-1000">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h2>{{ orm.id ? '#' ~ orm.id  : 'Creating new record...' }}</h2>
				</div>
				<div class="ibox-content">
					{% block form %}
						<form method="POST" novalidate autocomplete="off" action="?returnUrl={{ returnUrl }}">
							{{ form_widget(form) }}
							<div style="clear: both;"></div>
							<div>&nbsp;</div>
							<div class="submit-container">
								<a class="js-back btn btn-white" href="{{ returnUrl }}"><i class="fa fa-arrow-left"></i> &nbsp;Back</a>
								<input class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit" value="Save" name="submit" />
								<input class="btn btn-sm btn-success pull-right m-t-n-xs" type="submit" value="Apply" name="submit" />
								{#<input class="btn btn-sm btn-danger pull-right m-t-n-xs" type="submit" value="Delete" name="submit" />#}
							</div>
						</form>
					{% endblock %}
				</div>
			</div>
		</div>
	</div>

	<div id="popup-container" style="display: none;">
		<div class="row" style="margin: 0">
			<div class="col-lg-12" style="padding: 0">
				<div class="ibox">
					<div class="ibox-title">
						<div class="js-upload"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="row" style="margin: 0">
			<div class="col-lg-2" id="js-folders"></div>
			<div class="col-lg-10" id="js-files"></div>
		</div>
	</div>
{% endblock %}


{% block extraFooter %}
	<script id="file" type="text/x-handlebars-template">{% include 'pz/javascript/file.twig' %}</script>
	<script id="loading" type="text/x-handlebars-template">{% include 'pz/javascript/loading.twig' %}</script>
	<script id="template-upload" type="text/x-handlebars-template">
        {% verbatim %}
			<button class="btn btn-sm btn-info" onclick="$('#fileupload').click();">
				<i class="fa fa-upload"></i> Upload
			</button>
			<input id="fileupload" type="file" name="files[]" multiple style="display: none;">
			<div class="progress progress-striped" style="display: none;">
				<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
			</div>
		{% endverbatim %}
	</script>


	{#<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/jquery.iframe-transport.min.js"></script>#}
	{#<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/jquery.fileupload.min.js"></script>#}
	{#<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.min.js"></script>#}
	{#<script>#}

		{#$(function() {#}
			{#{% if app.request.get('cat') and not orm.id %}#}
				{#if ($('#form_category_select').length > 0 && $('#form_category').length > 0) {#}
					{#$('#form_category_select').val('{{ app.request.get('cat') }}');#}
					{#$('#form_category').val(JSON.stringify(['{{ app.request.get('cat') }}']));#}
				{#}#}
			{#{% endif %}#}


		{#});#}

	{#</script>#}
{% endblock %}